<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IntersectionObserverAPI 应用 | 小江大海</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href=".//vfiles.gtimg.cn/vupload/202005/6486c41590311911051.ico">
    <meta name="description" content="小江和小孙的博客站点">
    <link rel="preload" href="./assets/css/0.styles.8ff16dab.css" as="style"><link rel="preload" href="./assets/js/app.0d917daa.js" as="script"><link rel="preload" href="./assets/js/2.266c9ba2.js" as="script"><link rel="preload" href="./assets/js/7.f78cd1f2.js" as="script"><link rel="prefetch" href="./assets/js/10.e1166a09.js"><link rel="prefetch" href="./assets/js/3.d07fa4b8.js"><link rel="prefetch" href="./assets/js/4.374d559c.js"><link rel="prefetch" href="./assets/js/5.e6ff4ba7.js"><link rel="prefetch" href="./assets/js/6.1d6b75e8.js"><link rel="prefetch" href="./assets/js/8.e746212e.js"><link rel="prefetch" href="./assets/js/9.7f9684db.js">
    <link rel="stylesheet" href="./assets/css/0.styles.8ff16dab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">小江大海</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./about/" class="nav-link">
  关于我们
</a></div> <a href="https://github.com/sunmaer/lamour" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./about/" class="nav-link">
  关于我们
</a></div> <a href="https://github.com/sunmaer/lamour" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>💻 前端知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./frontend/standardPackage.html" class="sidebar-link">封装一个标准的 NPM 包</a></li><li><a href="/./frontend/intersectionObserver.html" aria-current="page" class="active sidebar-link">IntersectionObserverAPI 应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./frontend/intersectionObserver.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/./frontend/intersectionObserver.html#应用" class="sidebar-link">应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./frontend/intersectionObserver.html#图片懒加载" class="sidebar-link">图片懒加载</a></li><li class="sidebar-sub-header"><a href="/./frontend/intersectionObserver.html#元素吸顶、吸底" class="sidebar-link">元素吸顶、吸底</a></li><li class="sidebar-sub-header"><a href="/./frontend/intersectionObserver.html#加载更多" class="sidebar-link">加载更多</a></li><li class="sidebar-sub-header"><a href="/./frontend/intersectionObserver.html#曝光上报" class="sidebar-link">曝光上报</a></li></ul></li><li class="sidebar-sub-header"><a href="/./frontend/intersectionObserver.html#兼容性" class="sidebar-link">兼容性</a></li><li class="sidebar-sub-header"><a href="/./frontend/intersectionObserver.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>🚀 产品分享</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./produkt/demo.html" class="sidebar-link">产品评测</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>📷 生活感悟</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./life/demo.html" class="sidebar-link">旅行</a></li></ul></section></li><li><a href="/./about/" class="sidebar-link">💖 关于我们</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="intersectionobserverapi-应用"><a href="#intersectionobserverapi-应用" class="header-anchor">#</a> IntersectionObserverAPI 应用</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <blockquote><p>为了提升页面性能，项目中经常需要等待一些元素进入可视区域后再执行一些相关操作，比如图片懒加载或者加载更多等场景。我们一般都是监听根元素的 <code>scroll</code> 事件，然后结合元素的位置信息来判断，这种方法计算量大，而且 <code>scroll</code> 事件触发频率高很可能造成性能问题，以及代码阅读性不高。 <code>IntersectionObserver</code> 接口提供了一种异步观察目标元素与其祖先元素或顶级文档视窗 (viewport) 交叉状态的方法，<code>IntersectionObserver</code> 是异步的，不随着目标元素的滚动同步触发，性能较好；简洁的 API 清晰易读，逼格也很高。</p></blockquote> <p>今天主要给大家分享下本人在日常开发中关于 <code>IntersectionObserver</code> 的一些实际应用，关于 API 原理以及介绍大家可以阅读 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener noreferrer">Intersection Observer API - MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html" target="_blank" rel="noopener noreferrer">IntersectionObserver API 使用教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <ul><li><a href="https://sunmaer.github.io/juejin/intersection-observer/dist/" target="_blank" rel="noopener noreferrer">查看示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/sunmaer/juejin/tree/master/intersection-observer" target="_blank" rel="noopener noreferrer">示例代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="应用"><a href="#应用" class="header-anchor">#</a> 应用</h2> <h3 id="图片懒加载"><a href="#图片懒加载" class="header-anchor">#</a> 图片懒加载</h3> <p>使用 <code>IntersectionObserver</code> 非常容易实现图片懒加载，首先需要观察懒加载元素，然后等元素进入可视区域后设置图片 <code>src</code>；同时，还可以结合 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver/rootMargin" target="_blank" rel="noopener noreferrer">IntersectionObserver.rootMargin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实现提前加载图片，一般可以设置为 1~2 倍浏览器窗口的视口高度，优化用户体验。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * @method lazyLoad
 * @param {NodeList} $imgList      图片元素集合
 * @param {number}   preloadHeight 预加载高度
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token parameter">$imgList<span class="token punctuation">,</span> preloadHeight <span class="token operator">=</span> <span class="token number">1000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 目标元素出现在 root 可视区，返回 true</span>
        <span class="token keyword">const</span> $target <span class="token operator">=</span> entry<span class="token punctuation">.</span>target
        <span class="token keyword">const</span> src <span class="token operator">=</span> $target<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'lazyload'</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          $target<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span> <span class="token comment">// 真正加载图片</span>
        <span class="token punctuation">}</span>
        observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>$target<span class="token punctuation">)</span> <span class="token comment">// 解除观察</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    rootMargin<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0px 0px </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>preloadHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px 0px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>$imgList<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">$item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>$item<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token comment">// 过滤已经加载过的图片</span>
    observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>$item<span class="token punctuation">)</span> <span class="token comment">// 开始观察</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用方法：</p> <ul><li>图片元素设置 <code>lazyload</code> 属性</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">lazyload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>图片链接<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>图片说明<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>观察图片元素</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">lazyLoad</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;[lazyload]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="元素吸顶、吸底"><a href="#元素吸顶、吸底" class="header-anchor">#</a> 元素吸顶、吸底</h3> <p>在一些 APP 外的分享页中经常会看到头部或者底部会固定一个 banner 位，一开始 banner 可能处于正常位置，当即将离开可视区域的时候会固定在屏幕视口顶部或者底部，这种场景页非常适合用 <code>IntersectionObserver</code> 来处理。如果页面结构比较简单可以直接使用  <a href="https://www.zhangxinxu.com/wordpress/2018/12/css-position-sticky/" target="_blank" rel="noopener noreferrer"> css 粘性布局<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。<br> <code>IntersectionObserver</code> 实现元素固定思路也很简单，首先需要给固定元素包一层父元素，父元素指定高度占位，防止固定元素吸附时页面抖动，然后观察父元素的可视状态变化，当父元素即将离开可视区域时改变固定元素的样式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * @method fixBanner
 * @param {HTMLElement} $observeEle 观察元素
 * @param {HTMLElement} $fixEle     固定定位元素
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fixBanner</span><span class="token punctuation">(</span><span class="token parameter">$observeEle<span class="token punctuation">,</span> $fixEle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> $ele <span class="token operator">=</span> $fixEle
  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    entries<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        $ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token string">'position: fixed; top: 0; left: 0'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    threshold<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// threshold 设置为 1 表示目标元素完全可见时触发回调函数</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>$observeEle<span class="token punctuation">)</span> <span class="token comment">// 开始观察</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用方法：</p> <ul><li>元素结构</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 父元素用来占位和观察可视状态 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mod_banner<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>banner<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>吸顶元素<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>观察元素</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fixBanner</span><span class="token punctuation">(</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.mod_banner'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.banner'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="加载更多"><a href="#加载更多" class="header-anchor">#</a> 加载更多</h3> <p><code>IntersectionObserver</code> 实现加载更多需要在列表后面增加一个尾部元素（比如加载更多动画），当尾部元素进入可视区域就加载更多数据，注意尾部元素一定要一直处于所有列表元素的后面。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadMore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">entries</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> loadingEntry <span class="token operator">=</span> entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>loadingEntry<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 请求数据并插入列表</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      rootMargin<span class="token operator">:</span> <span class="token string">'0px 0px 600px 0px'</span><span class="token punctuation">,</span> <span class="token comment">// 提前加载高度</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>

  observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.mod_loading'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 观察尾部元素</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-! extra-class"><pre class="language-text"><code>提前加载高度不能随意设置，如果设置太大会导致尾部元素一直处于可视状态。
</code></pre></div><p><a href="https://github.com/sunmaer/juejin/blob/master/intersection-observer/src/components/list.vue#L45" target="_blank" rel="noopener noreferrer">完整代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="曝光上报"><a href="#曝光上报" class="header-anchor">#</a> 曝光上报</h3> <p>业务开发完成后，产品同学一般都需要我们去上报一些数据，项目上线后可以通过数据分析来进行产品迭代优化。基本上报事件会包括页面曝光、元素曝光和元素点击，页面曝光可以结合页面的生命周期上报，元素点击可以使用事件冒泡处理，而元素曝光检测非常麻烦。因为元素的层级关系复杂，影响元素显隐状态的样式属性也很多，导致我们往往会耗费很大的精力在元素的曝光计算上，而且还可能会对页面造成严重的性能问题。数据上报作为一个和页面展示无关的附加功能，不应该对页面的性能造成影响，所以这里非常适合用 <code>IntersectionObserver</code> 来完成。本人最近在参与一个数据上报项目，后面会单独写一篇关于上报的分享。</p> <h2 id="兼容性"><a href="#兼容性" class="header-anchor">#</a> 兼容性</h2> <p>这么好用的 API，我们当然要看下它的兼容性，不幸的是还有很多的浏览器不支持，不过官方提供了 <a href="https://github.com/w3c/IntersectionObserver/tree/master/polyfill" target="_blank" rel="noopener noreferrer">polyfill<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这样我们就可以在项目中愉快地使用了。</p> <ul><li>安装 ployfill</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> intersection-observer --save-dev
</code></pre></div><ul><li>入口文件引入</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'intersection-observer'</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>这篇文章主要给大家分享了 <code>IntersectionObserver API</code> 的一些应用，关于更多的使用场景等着我们去发掘。<br>
感谢您的阅读，文章中有什么不对的地方欢迎指出~</p> <p>参考文章</p> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener noreferrer">Intersection Observer API - MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html" target="_blank" rel="noopener noreferrer">IntersectionObserver API 使用教程 - 阮一峰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.zhangxinxu.com/wordpress/2018/12/css-position-sticky/" target="_blank" rel="noopener noreferrer">杀了个回马枪，还是说说position:sticky吧 - 张鑫旭<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/24/2020, 2:57:33 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/./frontend/standardPackage.html" class="prev">
        封装一个标准的 NPM 包
      </a></span> <span class="next"><a href="/./produkt/demo.html">
        产品评测
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.0d917daa.js" defer></script><script src="./assets/js/2.266c9ba2.js" defer></script><script src="./assets/js/7.f78cd1f2.js" defer></script>
  </body>
</html>
